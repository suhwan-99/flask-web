{% extends "detector/base.html" %}

{% block title %} 물체감지 인덱스 {% endblock %}

{% block content %}
  <h2>물체감지 인덱스 페이지</h2>
  <div class="col-md-10 text-right dt-image-register-btn">
    <a class="btn btn-primary" href="{{ url_for('detector.upload_image') }}">이미지 등록</a>

  </div>
  {% for msg in get_flashed_messages() %}
    <p style="color: red;"> {{msg}} </p>
  {% endfor %}
  {% for user_image in user_images %}
  <div class="card col-md-7 dt-image-content">
    <div>
      작성자 :{{user_image.User.username}}
    </div>
    <!-- 물체 감지 버튼 -->
    <form action="{{ url_for('detector.detect', image_id = user_image.UserImage.id) }}" method="post">
         <input type="hidden" name="csrf_token" value="{{csrf_token() }}">
         {% if current_user.id == user_image.User.id and user_image.UserImage.is_detected == False %}
          <input class="btn btn-primary" type="submit" value="물체 감지">
         {% else %}
          <input class="btn btn-primary" type="submit" value="물체 감지" disabled>
         {% endif %}
        </form>
    <!-- 삭제 처리 버튼 -->
    <form action="{{ url_for('detector.delete_image', image_id = user_image.UserImage.id) }}" method="post">
      <input type="hidden" name="csrf_token" value="{{csrf_token() }}">
         {% if current_user.id == user_image.User.id %}
          <input class="btn btn-danger" type="submit" value="삭제">
         {% else %}
          <input class="btn btn-danger" type="submit" value="삭제" disabled>
         {% endif %} 
    </form>    
              
      <section>
       <img src=" {{ url_for('detector.images', filename = user_image.UserImage.img_path) }}" alt="">
      </section>
      <!-- 감지된 이미지의 물체 목록들 표시 -->
      <footer>
        {% for tag in user_image_tag_dict[user_image.UserImage.id] %}
          <span>#{{tag.tag_name}}  </span>
        {% endfor %}
      </footer>
    </div>
  {% endfor %}
{% endblock %}